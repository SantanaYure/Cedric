<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ficha de Personagem Interativa - Cedric Starwyn</title>
    <style>
      /* Estilos CSS para a Ficha de Personagem */
      :root {
        --cor-principal: #3498db;
        --cor-fundo: #ecf0f1;
        --cor-texto: #2c3e50;
        --cor-borda: #bdc3c7;
        --cor-destaque: #e74c3c;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: var(--cor-fundo);
        color: var(--cor-texto);
        margin: 0;
        padding: 20px;
        display: flex;
        justify-content: center;
      }

      .ficha-container {
        width: 100%;
        max-width: 1200px;
        background-color: #ffffff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        border-radius: 10px;
        padding: 20px;
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: 20px;
      }

      header {
        grid-column: 1 / -1;
        text-align: center;
        border-bottom: 3px solid var(--cor-principal);
        padding-bottom: 10px;
        margin-bottom: 20px;
      }

      header h1 {
        margin: 0;
        color: var(--cor-principal);
      }

      .secao {
        border: 1px solid var(--cor-borda);
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
      }

      .secao h2 {
        margin-top: 0;
        color: var(--cor-destaque);
        border-bottom: 1px dashed var(--cor-borda);
        padding-bottom: 5px;
        margin-bottom: 10px;
      }

      /* Layout de Atributos */
      .atributos {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
      }

      .atributo {
        text-align: center;
        padding: 10px 5px;
        border: 2px solid var(--cor-principal);
        border-radius: 5px;
        background-color: #f8f9fa;
      }

      .atributo label {
        display: block;
        font-weight: bold;
        font-size: 0.8em;
        text-transform: uppercase;
        color: var(--cor-texto);
      }

      .atributo input[type="number"] {
        width: 80%;
        text-align: center;
        font-size: 1.5em;
        font-weight: bold;
        border: none;
        border-bottom: 2px solid var(--cor-destaque);
        margin: 5px 0;
        padding: 2px;
        background: transparent;
      }

      .atributo .modificador {
        font-size: 1.2em;
        font-weight: bold;
        color: var(--cor-principal);
      }

      /* Layout de Per√≠cias */
      .pericias ul {
        list-style: none;
        padding: 0;
      }

      .pericias li {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 5px 0;
        border-bottom: 1px dotted var(--cor-borda);
      }

      .pericias li:last-child {
        border-bottom: none;
      }

      .pericias .valor {
        font-weight: bold;
        color: var(--cor-destaque);
      }

      /* Layout de Combate e Estat√≠sticas */
      .estatisticas-combate {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        text-align: center;
      }

      .estatistica {
        padding: 10px;
        border: 1px solid var(--cor-borda);
        border-radius: 5px;
      }

      .estatistica .valor {
        font-size: 1.5em;
        font-weight: bold;
        color: var(--cor-principal);
      }

      .estatistica label {
        display: block;
        font-size: 0.8em;
        text-transform: uppercase;
      }

      /* Habilidades e Talentos */
      .habilidades-talentos {
        grid-column: 1 / -1;
      }

      .habilidade-item {
        margin-bottom: 10px;
        padding: 10px;
        border-left: 5px solid var(--cor-destaque);
        background-color: #f4f4f4;
        border-radius: 0 5px 5px 0;
      }

      .habilidade-item h3 {
        margin-top: 0;
        color: var(--cor-principal);
      }

      /* Formul√°rio de Entrada */
      input[type="text"],
      textarea {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        margin-bottom: 10px;
        border: 1px solid var(--cor-borda);
        border-radius: 4px;
        box-sizing: border-box;
      }

      textarea {
        resize: vertical;
      }

      /* Estilos para a se√ß√£o de Itens/Equipamentos */
      .equipamentos ul {
        list-style: none;
        padding: 0;
      }

      .equipamentos li {
        padding: 5px 0;
        border-bottom: 1px dotted var(--cor-borda);
      }

      .equipamentos li:last-child {
        border-bottom: none;
      }

      .equipamentos h3 {
        margin-top: 0;
        margin-bottom: 10px;
        color: var(--cor-principal);
        font-size: 0.95em;
      }

      /* Estilos para bot√µes */
      button {
        transition: all 0.3s ease;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
      }

      button:active {
        transform: translateY(0);
      }

      /* Estilos para a se√ß√£o de controles */
      .controles-ficha {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: 15px;
      }

      /* Responsividade b√°sica */
      @media (max-width: 768px) {
        .ficha-container {
          grid-template-columns: 1fr;
        }
        .atributos {
          grid-template-columns: repeat(2, 1fr);
        }
        .estatisticas-combate {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="ficha-container">
      <header>
        <h1>Ficha de Personagem - Cedric Starwyn</h1>
        <p>Monge - Caminho da Forma Astral | N√≠vel 5 | Humano</p>
      </header>

      <!-- Coluna Esquerda: Atributos, Per√≠cias, Estat√≠sticas -->
      <div class="coluna-esquerda">
        <div class="secao">
          <h2>Atributos</h2>
          <div class="atributos">
            <!-- For√ßa -->
            <div class="atributo">
              <label for="forca-valor">For√ßa</label>
              <input
                type="number"
                id="forca-valor"
                value="8"
                min="1"
                max="30"
                onchange="calcularFicha()"
              />
              <div class="modificador" id="forca-mod">-1</div>
            </div>
            <!-- Destreza -->
            <div class="atributo">
              <label for="destreza-valor">Destreza</label>
              <input
                type="number"
                id="destreza-valor"
                value="16"
                min="1"
                max="30"
                onchange="calcularFicha()"
              />
              <div class="modificador" id="destreza-mod">+3</div>
            </div>
            <!-- Constitui√ß√£o -->
            <div class="atributo">
              <label for="constituicao-valor">Constitui√ß√£o</label>
              <input
                type="number"
                id="constituicao-valor"
                value="16"
                min="1"
                max="30"
                onchange="calcularFicha()"
              />
              <div class="modificador" id="constituicao-mod">+3</div>
            </div>
            <!-- Intelig√™ncia -->
            <div class="atributo">
              <label for="inteligencia-valor">Intelig√™ncia</label>
              <input
                type="number"
                id="inteligencia-valor"
                value="10"
                min="1"
                max="30"
                onchange="calcularFicha()"
              />
              <div class="modificador" id="inteligencia-mod">+0</div>
            </div>
            <!-- Sabedoria -->
            <div class="atributo">
              <label for="sabedoria-valor">Sabedoria</label>
              <input
                type="number"
                id="sabedoria-valor"
                value="18"
                min="1"
                max="30"
                onchange="calcularFicha()"
              />
              <div class="modificador" id="sabedoria-mod">+4</div>
            </div>
            <!-- Carisma -->
            <div class="atributo">
              <label for="carisma-valor">Carisma</label>
              <input
                type="number"
                id="carisma-valor"
                value="13"
                min="1"
                max="30"
                onchange="calcularFicha()"
              />
              <div class="modificador" id="carisma-mod">+1</div>
            </div>
          </div>
        </div>

        <div class="secao">
          <h2>Estat√≠sticas de Combate</h2>
          <div class="estatisticas-combate">
            <div class="estatistica">
              <label>CA</label>
              <div class="valor" id="ca-valor">17</div>
              <small>(10 + Des + Sab)</small>
            </div>
            <div class="estatistica">
              <label>Iniciativa</label>
              <div class="valor" id="iniciativa-valor">+3</div>
            </div>
            <div class="estatistica">
              <label>Deslocamento</label>
              <div class="valor" id="deslocamento-valor">12m</div>
              <small>(+3m Mov. Sem Armadura)</small>
            </div>
            <div class="estatistica">
              <label>Pontos de Vida</label>
              <div class="valor" id="pv-max-valor">53</div>
              <small>(M√°ximo)</small>
            </div>
            <div class="estatistica">
              <label>Pontos de Ki</label>
              <div class="valor" id="ki-max-valor">5</div>
              <small>(N√≠vel de Monge)</small>
            </div>
            <div class="estatistica">
              <label>CD de Resist√™ncia</label>
              <div class="valor" id="cd-resistencia-valor">15</div>
              <small>(8 + Prof + Sab)</small>
            </div>
          </div>
        </div>

        <div class="secao pericias">
          <h2>Per√≠cias</h2>
          <ul id="lista-pericias">
            <!-- As per√≠cias ser√£o preenchidas pelo JavaScript -->
          </ul>
          <div class="estatistica" style="margin-top: 10px">
            <label>Percep√ß√£o Passiva</label>
            <div class="valor" id="percepcao-passiva-valor">17</div>
          </div>
        </div>

        <div class="secao">
          <h2>Estado Atual</h2>
          <div class="estatisticas-combate">
            <div class="estatistica">
              <label>Pontos de Vida</label>
              <div class="valor" id="pv-atual-valor">53</div>
              <small>(Atual / M√°x)</small>
            </div>
            <div class="estatistica">
              <label>Pontos de Ki</label>
              <div class="valor" id="ki-atual-valor">5/5</div>
              <small>(Atual / M√°x)</small>
            </div>
            <div class="estatistica">
              <label>Pontos de Sorte</label>
              <div class="valor" id="sorte-atual-valor">3</div>
              <small>(Dispon√≠veis)</small>
            </div>
          </div>
        </div>

        <div class="secao">
          <h2>Equipamentos e Moedas</h2>
          <div class="equipamentos">
            <h3>Itens</h3>
            <ul id="lista-equipamentos">
              <li>Pacote de Explorador</li>
              <li>1 Guitarra Cl√°ssica</li>
              <li>5 Adagas</li>
              <li>1 Kusarigama</li>
              <li>2 Algibeiras</li>
              <li>Roupas de Viagem</li>
              <li>Saco de Dormir</li>
            </ul>
            <p
              style="
                margin-top: 10px;
                display: flex;
                align-items: center;
                gap: 8px;
              "
            >
              <strong>Moedas:</strong>
              <button
                type="button"
                id="btn-moedas-menos"
                style="
                  background: #e74c3c;
                  color: #fff;
                  border: none;
                  border-radius: 4px;
                  width: 28px;
                  height: 28px;
                  font-size: 1.2em;
                  cursor: pointer;
                "
              >
                -
              </button>
              <input
                type="number"
                id="input-moedas-po"
                value="175"
                min="0"
                style="
                  width: 70px;
                  text-align: right;
                  border-radius: 4px;
                  border: 1px solid var(--cor-borda);
                  padding: 4px;
                  font-size: 1em;
                "
              />
              <button
                type="button"
                id="btn-moedas-mais"
                style="
                  background: #27ae60;
                  color: #fff;
                  border: none;
                  border-radius: 4px;
                  width: 28px;
                  height: 28px;
                  font-size: 1.2em;
                  cursor: pointer;
                "
              >
                +
              </button>
              <span>PO</span>
            </p>
            <script>
              // Controle de edi√ß√£o de moedas
              const inputMoedas = document.getElementById("input-moedas-po");
              const btnMais = document.getElementById("btn-moedas-mais");
              const btnMenos = document.getElementById("btn-moedas-menos");
              inputMoedas.addEventListener("change", function () {
                if (
                  parseInt(inputMoedas.value) < 0 ||
                  isNaN(parseInt(inputMoedas.value))
                )
                  inputMoedas.value = 0;
              });
              btnMais.addEventListener("click", function () {
                inputMoedas.value = parseInt(inputMoedas.value) + 1;
                inputMoedas.dispatchEvent(new Event("change"));
              });
              btnMenos.addEventListener("click", function () {
                inputMoedas.value = Math.max(
                  0,
                  parseInt(inputMoedas.value) - 1
                );
                inputMoedas.dispatchEvent(new Event("change"));
              });
            </script>
          </div>
        </div>
      </div>

      <!-- Coluna Direita: Habilidades, Talentos, Ataques -->
      <div class="coluna-direita">
        <div class="secao">
          <h2>Ataques e Profici√™ncias</h2>
          <p>
            <strong>B√¥nus de Profici√™ncia:</strong>
            <span id="bonus-proficiencia">+3</span>
          </p>
          <p>
            <strong>Profici√™ncias:</strong> Armas Simples, Marciais (Leve),
            Ferramentas de Ladr√£o, Guitarra Cl√°ssica
          </p>
          <p><strong>Idiomas:</strong> Comum</p>
          <div class="ataques">
            <h3>Ataques Principais</h3>
            <div class="habilidade-item">
              <h3>Ataque Desarmado / Arma de Monge</h3>
              <p>
                <strong>Dano:</strong> 1d8 +
                <span id="dano-mod-monge">+3</span> (Destreza/Sabedoria) |
                <strong>Tipo:</strong> Contus√£o/Energia
              </p>
              <p>
                <strong>B√¥nus de Ataque:</strong>
                <span id="ataque-bonus-monge">+6</span> (Prof + Des/Sab)
              </p>
              <button
                class="btn-ki"
                data-habilidade="Rajada de Golpes"
                onclick="usarHabilidade('Rajada de Golpes')"
              >
                Rajada de Golpes (1 Ki)
              </button>
              <button
                class="btn-ki"
                data-habilidade="Ataque Atordoante"
                onclick="usarHabilidade('Ataque Atordoante')"
              >
                Ataque Atordoante (1 Ki)
              </button>
              <button
                class="btn-ki"
                data-habilidade="Bra√ßos da Forma Astral"
                onclick="usarHabilidade('Bra√ßos da Forma Astral')"
              >
                Bra√ßos da Forma Astral (1 Ki)
              </button>
              <button
                class="btn-ki"
                data-habilidade="Mira Focada"
                onclick="usarHabilidade('Mira Focada')"
              >
                Mira Focada (1-3 Ki)
              </button>
              <button
                class="btn-ki"
                data-habilidade="Defesa Paciente"
                onclick="usarHabilidade('Defesa Paciente')"
              >
                Defesa Paciente (1 Ki)
              </button>
              <button
                class="btn-ki"
                data-habilidade="Passos do Vento"
                onclick="usarHabilidade('Passos do Vento')"
              >
                Passos do Vento (1 Ki)
              </button>
              <style>
                .btn-ki {
                  padding: 8px 12px;
                  margin: 5px 2px;
                  background-color: var(--cor-destaque);
                  color: white;
                  border: none;
                  border-radius: 4px;
                  cursor: pointer;
                  font-weight: bold;
                  transition: background 0.2s;
                }
                .btn-ki:hover {
                  background-color: #c0392b;
                }
                .modal-ki {
                  display: none;
                  position: fixed;
                  z-index: 1000;
                  left: 0;
                  top: 0;
                  width: 100vw;
                  height: 100vh;
                  background: rgba(0, 0, 0, 0.3);
                  justify-content: center;
                  align-items: center;
                }
                .modal-ki-content {
                  background: #fff;
                  color: #222;
                  border-radius: 8px;
                  padding: 24px 20px;
                  max-width: 400px;
                  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
                  font-size: 1.05em;
                }
                .modal-ki-close {
                  float: right;
                  font-size: 1.2em;
                  cursor: pointer;
                  color: #888;
                }
                .modal-ki-close:hover {
                  color: #e74c3c;
                }
              </style>

              <div id="kiDescricaoCard" style="display: none"></div>

              <script>
                const textosKi = {
                  "Rajada de Golpes":
                    "Gaste 1 Ki para fazer dois Ataques Desarmados como A√ß√£o B√¥nus.",
                  "Defesa Paciente":
                    "Use Desengajar ou, com 1 Ki, Desengajar e Esquivar.",
                  "Passos do Vento":
                    "Use Disparada ou, com 1 Ki, Desengajar + Disparada e salto dobrado.",
                  "Bra√ßos da Forma Astral":
                    "B√¥nus: usa Sabedoria em testes de For√ßa, ataques desarmados com alcance aumentado e dano de energia. Pode causar dano ao invocar (teste de Destreza do alvo). Dura 10 min.",
                  "Ataque Atordoante":
                    "Ao acertar, gaste 1 Ki: alvo faz teste de Constitui√ß√£o. Falha: atordoado at√© fim do pr√≥ximo turno. Sucesso: velocidade reduzida e pr√≥xima jogada contra ele tem vantagem.",
                  "Mira Focada":
                    "Ao errar um ataque, gaste 1-3 Ki para somar +2 por ponto √† jogada.",
                };
                // Card de descri√ß√£o das habilidades de Ki
                const card = document.getElementById("kiDescricaoCard");
                card.style.position = "relative";
                card.style.background = "#fff";
                card.style.color = "#222";
                card.style.border = "1px solid #e74c3c";
                card.style.borderRadius = "8px";
                card.style.padding = "14px 18px";
                card.style.marginTop = "10px";
                card.style.boxShadow = "0 2px 8px rgba(0,0,0,0.08)";
                card.style.maxWidth = "600px";
                card.style.fontSize = "1em";
                card.style.transition = "opacity 0.2s";
                card.style.opacity = 0;

                const containerBotoes = document.querySelector(
                  ".ataques .habilidade-item"
                );
                if (containerBotoes) {
                  containerBotoes.appendChild(card);
                }

                document.querySelectorAll(".btn-ki").forEach((btn) => {
                  btn.addEventListener("mouseenter", function (e) {
                    const nome = btn.getAttribute("data-habilidade");
                    const texto = textosKi[nome] || "";
                    card.textContent = texto;
                    card.style.display = "block";
                    setTimeout(() => {
                      card.style.opacity = 1;
                    }, 10);
                  });
                  btn.addEventListener("mouseleave", function (e) {
                    card.style.opacity = 0;
                    setTimeout(() => {
                      card.style.display = "none";
                    }, 200);
                  });
                });
              </script>
            </div>
          </div>
        </div>

        <div class="secao habilidades-talentos">
          <h2>Habilidades de Classe e Subclasse</h2>
          <div id="lista-habilidades">
            <!-- As habilidades ser√£o preenchidas pelo JavaScript -->
          </div>
        </div>

        <div class="secao habilidades-talentos">
          <h2>Talentos</h2>
          <div id="lista-talentos">
            <!-- Os talentos ser√£o preenchidos pelo JavaScript -->
          </div>
        </div>
      </div>
    </div>

    <script>
      // Dados iniciais do personagem (baseados no DOCX)
      let estadoFicha = {
        pvAtual: 53,
        kiAtual: 5,
        pontosSorte: 3,
      };

      const personagem = {
        nivel: 5,
        bonusProficiencia: 3, // N√≠vel 5 = +3
        dadosVida: 8, // d8 para Monge
        atributos: {
          forca: 8,
          destreza: 16,
          constituicao: 16,
          inteligencia: 10,
          sabedoria: 18,
          carisma: 13,
        },
        pericias: {
          acrobacia: {
            atributo: "destreza",
            proficiente: true,
            especializacao: false,
          },
          furtividade: {
            atributo: "destreza",
            proficiente: true,
            especializacao: true,
          }, // Assumindo Especializa√ß√£o (2x Prof) para bater com o valor +6 do DOCX (3+3)
          historia: {
            atributo: "inteligencia",
            proficiente: true,
            especializacao: false,
          },
          intuicao: {
            atributo: "sabedoria",
            proficiente: true,
            especializacao: true,
          }, // Assumindo Especializa√ß√£o (2x Prof) para bater com o valor +7 do DOCX (4+3)
          percepcao: {
            atributo: "sabedoria",
            proficiente: true,
            especializacao: false,
          }, // Linhagem (Assumindo profici√™ncia)
          // Outras per√≠cias padr√£o de D&D 5e (n√£o listadas no DOCX, mas √∫teis para a ficha)
          atletismo: {
            atributo: "forca",
            proficiente: false,
            especializacao: false,
          },
          arcanismo: {
            atributo: "inteligencia",
            proficiente: false,
            especializacao: false,
          },
          atuacao: {
            atributo: "carisma",
            proficiente: false,
            especializacao: false,
          },
          enganacao: {
            atributo: "carisma",
            proficiente: false,
            especializacao: false,
          },
          intimidacao: {
            atributo: "carisma",
            proficiente: false,
            especializacao: false,
          },
          investigacao: {
            atributo: "inteligencia",
            proficiente: false,
            especializacao: false,
          },
          lidarAnimais: {
            atributo: "sabedoria",
            proficiente: false,
            especializacao: false,
          },
          medicina: {
            atributo: "sabedoria",
            proficiente: false,
            especializacao: false,
          },
          natureza: {
            atributo: "inteligencia",
            proficiente: false,
            especializacao: false,
          },
          persuasao: {
            atributo: "carisma",
            proficiente: false,
            especializacao: false,
          },
          religiao: {
            atributo: "inteligencia",
            proficiente: false,
            especializacao: false,
          },
          sobrevivencia: {
            atributo: "sabedoria",
            proficiente: false,
            especializacao: false,
          },
          // ... adicione mais conforme a necessidade
        },
        habilidades: [
          {
            nome: "Artes Marciais",
            descricao:
              "Dado de Dano 1d8. Usa Destreza para ataque/dano. Ataque Desarmado como A√ß√£o B√¥nus.",
          },
          {
            nome: "Defesa sem Armadura",
            descricao: "CA = 10 + Mod Destreza (+3) + Mod Sabedoria (+4) = 17.",
          },
          {
            nome: "Ki",
            descricao:
              "5 Pontos de Ki. CD de Resist√™ncia 15. Habilidades: Rajada de Golpes, Defesa Paciente, Passos do Vento.",
          },
          {
            nome: "Movimento Sem Armadura",
            descricao: "Deslocamento aumenta em +3m (Total 12m).",
          },
          {
            nome: "Metabolismo Sobrenatural",
            descricao:
              "Ao rolar Iniciativa, pode recuperar Ki e PV (1d8 + N√≠vel) uma vez por Descanso Longo.",
          },
          {
            nome: "Queda Lenta",
            descricao: "Reduz dano de queda em 5 x N√≠vel (25) como Rea√ß√£o.",
          },
          {
            nome: "Ataque Extra",
            descricao: "Pode realizar dois ataques ao usar a a√ß√£o de Ataque.",
          },
          {
            nome: "Ataque Atordoante",
            descricao:
              "1 Ki. Teste de Resist√™ncia de Constitui√ß√£o CD 15. Falha: Atordoado. Sucesso: Velocidade reduzida e Vantagem no pr√≥ximo ataque contra ele.",
          },
          {
            nome: "Mira Focada",
            descricao:
              "1-3 Ki. +2 na jogada de ataque por ponto gasto ao errar.",
          },
          {
            nome: "Bra√ßos da Forma Astral (Subclasse)",
            descricao:
              "1 Ki, A√ß√£o B√¥nus. Dura 10 min. Causa 2d8 dano de energia (Teste Destreza). Benef√≠cios: Usa Sabedoria em testes/resist√™ncias de For√ßa, Ataques Desarmados com Alcance +1,5m, usa Sabedoria para ataque/dano de energia.",
          },
        ],
        talentos: [
          {
            nome: "Resiliente (Monge)",
            descricao:
              "Aumenta Sabedoria em 1 (j√° incluso no valor 18). Ganha profici√™ncia em salvaguardas de Sabedoria.",
          },
          {
            nome: "Sortudo (Origem)",
            descricao:
              "Voc√™ possui 'Pontos de Sorte' iguais ao seu B√¥nus de Profici√™ncia. Pode gast√°-los para obter Vantagem em um teste de d20 ou impor Desvantagem em uma jogada de ataque contra voc√™. Os Pontos de Sorte s√£o restaurados ap√≥s um Descanso Longo.",
          },
          {
            nome: "Vigoroso (Humano)",
            descricao:
              "PV M√°x aumentam em 2 x N√≠vel (10) + 2 PV adicionais por n√≠vel (Total 10 + 2*4 = 18 PV extras no N√≠vel 5). J√° incluso no PV M√°x.",
          },
        ],
      };

      // Fun√ß√£o para calcular o modificador de atributo
      function calcularModificador(valor) {
        return Math.floor((valor - 10) / 2);
      }

      // Fun√ß√£o para obter o valor da per√≠cia
      function getPericiaValor(pericia, modAtributo, bonusProficiencia) {
        const dados = personagem.pericias[pericia];
        let valorPericia = modAtributo;

        if (dados.proficiente) {
          valorPericia += bonusProficiencia;
        }

        // Se houver especializa√ß√£o (2x Prof), aplicar
        if (dados.especializacao) {
          valorPericia += bonusProficiencia; // Adiciona a profici√™ncia novamente
        }

        return valorPericia;
      }

      // Fun√ß√£o principal de c√°lculo e atualiza√ß√£o da ficha
      function calcularFicha() {
        // 1. Atualizar valores de atributos e modificadores
        const atributosInputs = {
          forca: document.getElementById("forca-valor"),
          destreza: document.getElementById("destreza-valor"),
          constituicao: document.getElementById("constituicao-valor"),
          inteligencia: document.getElementById("inteligencia-valor"),
          sabedoria: document.getElementById("sabedoria-valor"),
          carisma: document.getElementById("carisma-valor"),
        };

        for (const attr in atributosInputs) {
          const valor = parseInt(atributosInputs[attr].value);
          personagem.atributos[attr] = valor;
          const mod = calcularModificador(valor);
          document.getElementById(`${attr}-mod`).textContent =
            (mod >= 0 ? "+" : "") + mod;
        }

        const modDestreza = calcularModificador(personagem.atributos.destreza);
        const modSabedoria = calcularModificador(
          personagem.atributos.sabedoria
        );
        const modConstituicao = calcularModificador(
          personagem.atributos.constituicao
        );
        const bonusProficiencia = personagem.bonusProficiencia;

        // 2. Calcular Estat√≠sticas de Combate
        // CA (Defesa sem Armadura)
        const ca = 10 + modDestreza + modSabedoria;
        document.getElementById("ca-valor").textContent = ca;

        // Iniciativa
        document.getElementById("iniciativa-valor").textContent =
          (modDestreza >= 0 ? "+" : "") + modDestreza;

        // PV M√°ximo (5d8+15 + Vigoroso)
        // PV base = N√≠vel * Dado de Vida (m√©dia) + N√≠vel * Mod Constitui√ß√£o
        // Monge N√≠vel 5: 5 * (4.5) + 5 * 3 = 22.5 + 15 = 37.5. Arredondando para cima: 38.
        // O DOCX diz 53. A diferen√ßa √© 15.
        // Vigoroso: 2 * N√≠vel (10) + 2 * (N√≠vel - 1) = 10 + 8 = 18.
        // PV M√°x = (8 + 4 * (4.5 + ModConstituicao)) + Vigoroso (18)
        // PV M√°x = 8 + 4 * (4.5 + 3) + 18 = 8 + 4 * 7.5 + 18 = 8 + 30 + 18 = 56.
        // O DOCX diz 53. Vamos usar o valor do DOCX e ajustar a f√≥rmula para ser mais flex√≠vel.
        // C√°lculo de PV M√°ximo (Monge N√≠vel 5, d8, Con +3, Vigoroso)
        // PV N√≠vel 1: 8 + ModCon = 8 + 3 = 11
        // PV N√≠veis 2-5: 4 * (4.5 + ModCon) = 4 * (4.5 + 3) = 4 * 7.5 = 30
        // Vigoroso: 2 * N√≠vel = 10
        // Total: 11 + 30 + 10 = 51. O DOCX diz 53. Vamos usar o valor do DOCX para manter a fidelidade.
        // const pvMax = 8 + (personagem.nivel - 1) * 5 + personagem.nivel * modConstituicao + (personagem.talentos.some(t => t.nome.includes("Vigoroso")) ? 2 * personagem.nivel : 0);
        // document.getElementById("pv-max-valor").textContent = pvMax;
        document.getElementById("pv-max-valor").textContent = 53;

        // Pontos de Ki
        document.getElementById("ki-max-valor").textContent = personagem.nivel;

        // CD de Resist√™ncia
        const cdResistencia = 8 + bonusProficiencia + modSabedoria;
        document.getElementById("cd-resistencia-valor").textContent =
          cdResistencia;

        // B√¥nus de Profici√™ncia
        document.getElementById("bonus-proficiencia").textContent =
          (bonusProficiencia >= 0 ? "+" : "") + bonusProficiencia;

        // 3. Calcular Per√≠cias
        const listaPericias = document.getElementById("lista-pericias");
        listaPericias.innerHTML = ""; // Limpa a lista

        for (const pericia in personagem.pericias) {
          const dados = personagem.pericias[pericia];
          const modAtributo = calcularModificador(
            personagem.atributos[dados.atributo]
          );
          const valorPericia = getPericiaValor(
            pericia,
            modAtributo,
            bonusProficiencia
          );

          const li = document.createElement("li");
          li.innerHTML = `
                    <span>${
                      pericia.charAt(0).toUpperCase() + pericia.slice(1)
                    } (${dados.atributo.charAt(0).toUpperCase()})</span>
                    <span class="valor">${
                      (valorPericia >= 0 ? "+" : "") + valorPericia
                    }</span>
                `;
          listaPericias.appendChild(li);
        }

        // Percep√ß√£o Passiva
        const percepcaoPassiva =
          10 + getPericiaValor("percepcao", modSabedoria, bonusProficiencia); // Usa a fun√ß√£o de c√°lculo para consist√™ncia
        document.getElementById("percepcao-passiva-valor").textContent =
          percepcaoPassiva;

        // 4. Atualizar Ataques
        // Dano e B√¥nus de Ataque (Monge usa Destreza ou Sabedoria, o maior)
        const modAtaqueMonge = Math.max(modDestreza, modSabedoria);
        const bonusAtaqueMonge = bonusProficiencia + modAtaqueMonge;
        document.getElementById("dano-mod-monge").textContent =
          (modAtaqueMonge >= 0 ? "+" : "") + modAtaqueMonge;
        document.getElementById("ataque-bonus-monge").textContent =
          (bonusAtaqueMonge >= 0 ? "+" : "") + bonusAtaqueMonge;

        // 5. Preencher Habilidades e Talentos
        preencherHabilidades();
        preencherTalentos();
      }

      function preencherHabilidades() {
        const listaHabilidades = document.getElementById("lista-habilidades");
        listaHabilidades.innerHTML = "";
        personagem.habilidades.forEach((h) => {
          const div = document.createElement("div");
          div.className = "habilidade-item";
          div.innerHTML = `
                    <h3>${h.nome}</h3>
                    <p>${h.descricao}</p>
                `;
          listaHabilidades.appendChild(div);
        });
      }

      function preencherTalentos() {
        const listaTalentos = document.getElementById("lista-talentos");
        listaTalentos.innerHTML = "";
        personagem.talentos.forEach((t) => {
          const div = document.createElement("div");
          div.className = "habilidade-item";
          div.innerHTML = `
                    <h3>${t.nome}</h3>
                    <p>${t.descricao}</p>
                `;
          listaTalentos.appendChild(div);
        });
      }

      // Fun√ß√£o para rolar dados (ex: 1d8, 2d6)
      function rolarDados(numDados, numFaces) {
        let total = 0;
        let rolls = [];
        for (let i = 0; i < numDados; i++) {
          const roll = Math.floor(Math.random() * numFaces) + 1;
          rolls.push(roll);
          total += roll;
        }
        return { total, rolls };
      }

      // Fun√ß√£o para usar habilidades apenas administrando recursos
      function usarHabilidade(nome) {
        let kiGasto = 0;
        switch (nome) {
          case "Rajada de Golpes":
          case "Ataque Atordoante":
          case "Bra√ßos da Forma Astral":
          case "Defesa Paciente":
          case "Passos do Vento":
            kiGasto = 1;
            break;
          case "Mira Focada":
            kiGasto = Math.min(3, estadoFicha.kiAtual);
            break;
          default:
            kiGasto = 0;
        }

        if (kiGasto > 0) {
          if (estadoFicha.kiAtual >= kiGasto) {
            estadoFicha.kiAtual -= kiGasto;
            atualizarEstadoFicha();
            alert(`Ki restante: ${estadoFicha.kiAtual}`);
          } else {
            alert(`Ki insuficiente!`);
          }
        } else {
          alert(`Voc√™ usou "${nome}".`);
        }
      }

      // Fun√ß√£o para usar Pontos de Sorte
      function usarPontoSorte() {
        if (estadoFicha.pontosSorte > 0) {
          const tipo = confirm(
            "Clique OK para Vantagem em d20, Cancelar para Desvantagem em ataque contra voc√™"
          );
          estadoFicha.pontosSorte--;
          atualizarEstadoFicha();
          alert(
            `Ponto de Sorte usado! Pontos restantes: ${estadoFicha.pontosSorte}`
          );
        } else {
          alert("Nenhum Ponto de Sorte dispon√≠vel!");
        }
      }

      // Fun√ß√£o para descanso curto (recupera Ki)
      function descansoCurto() {
        estadoFicha.kiAtual = personagem.nivel;
        alert(
          `Descanso Curto conclu√≠do!\nPontos de Ki recuperados: ${personagem.nivel}`
        );
        atualizarEstadoFicha();
      }

      // Fun√ß√£o para descanso longo (recupera Ki, PV, Pontos de Sorte)
      function descansoLongo() {
        estadoFicha.kiAtual = personagem.nivel;
        estadoFicha.pvAtual = parseInt(
          document.getElementById("pv-max-valor").textContent
        );
        estadoFicha.pontosSorte = personagem.bonusProficiencia;
        alert(
          `Descanso Longo conclu√≠do!\nPontos de Ki: ${personagem.nivel}\nPontos de Vida: ${estadoFicha.pvAtual}\nPontos de Sorte: ${personagem.bonusProficiencia}`
        );
        atualizarEstadoFicha();
      }

      // Fun√ß√£o para atualizar o estado da ficha na tela
      function atualizarEstadoFicha() {
        document.getElementById(
          "ki-atual-valor"
        ).textContent = `${estadoFicha.kiAtual}/${personagem.nivel}`;
        document.getElementById("pv-atual-valor").textContent = `${
          estadoFicha.pvAtual
        }/${document.getElementById("pv-max-valor").textContent}`;
        document.getElementById("sorte-atual-valor").textContent =
          estadoFicha.pontosSorte;
      }

      // Fun√ß√£o para salvar dados em localStorage
      function salvarFicha() {
        const dados = {
          personagem: personagem,
          estado: estadoFicha,
          timestamp: new Date().toISOString(),
        };
        localStorage.setItem("ficha_cedric", JSON.stringify(dados));
        alert("Ficha salva com sucesso!");
      }

      // Fun√ß√£o para carregar dados do localStorage
      function carregarFicha() {
        const dados = localStorage.getItem("ficha_cedric");
        if (dados) {
          const parsed = JSON.parse(dados);
          Object.assign(personagem, parsed.personagem);
          Object.assign(estadoFicha, parsed.estado);
          calcularFicha();
          alert("Ficha carregada com sucesso!");
        } else {
          alert("Nenhuma ficha salva encontrada.");
        }
      }

      // Fun√ß√£o para exportar ficha como JSON
      function exportarFicha() {
        const dados = {
          personagem: personagem,
          estado: estadoFicha,
          timestamp: new Date().toISOString(),
        };
        const json = JSON.stringify(dados, null, 2);
        const blob = new Blob([json], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "cedric_starwyn_ficha.json";
        a.click();
        URL.revokeObjectURL(url);
      }

      // Inicializa a ficha ao carregar a p√°gina
      window.onload = () => {
        if (localStorage.getItem("ficha_cedric")) {
          carregarFicha();
        } else {
          calcularFicha();
        }
        adicionarBotoesControle();
        adicionarControleDano();
        adicionarEditorItens();
        atualizarEstadoFicha();
      };
      // Fun√ß√£o para adicionar editor de itens
      function adicionarEditorItens() {
        const lista = document.getElementById("lista-equipamentos");
        if (!lista) return;

        // Carregar itens do personagem, se existir
        if (!personagem.itens) {
          personagem.itens = [];
          // Preenche com os itens do HTML, se n√£o houver ainda
          lista.querySelectorAll("li").forEach((li) => {
            personagem.itens.push(li.textContent.trim());
          });
        }

        // Renderiza a lista edit√°vel
        function renderizarItens() {
          lista.innerHTML = "";
          personagem.itens.forEach((item, idx) => {
            const li = document.createElement("li");
            const input = document.createElement("input");
            input.type = "text";
            input.value = item;
            input.style.width = "70%";
            input.style.marginRight = "6px";
            input.onchange = () => {
              personagem.itens[idx] = input.value;
              salvarFicha();
            };
            const btnRemover = document.createElement("button");
            btnRemover.textContent = "üóëÔ∏è";
            btnRemover.title = "Remover";
            btnRemover.style.marginLeft = "4px";
            btnRemover.style.background = "none";
            btnRemover.style.border = "none";
            btnRemover.style.cursor = "pointer";
            btnRemover.onclick = () => {
              personagem.itens.splice(idx, 1);
              renderizarItens();
              salvarFicha();
            };
            li.appendChild(input);
            li.appendChild(btnRemover);
            lista.appendChild(li);
          });
        }

        // Formul√°rio para adicionar novo item
        const form = document.createElement("form");
        form.style.display = "flex";
        form.style.gap = "6px";
        form.style.marginTop = "8px";
        form.onsubmit = function (e) {
          e.preventDefault();
          const input = form.querySelector("input");
          const novoItem = input.value.trim();
          if (novoItem) {
            personagem.itens.push(novoItem);
            renderizarItens();
            salvarFicha();
            input.value = "";
          }
        };
        const inputNovo = document.createElement("input");
        inputNovo.type = "text";
        inputNovo.placeholder = "Novo item";
        inputNovo.style.flex = "1";
        inputNovo.style.borderRadius = "4px";
        inputNovo.style.border = "1px solid var(--cor-borda)";
        inputNovo.style.padding = "4px";
        const btnAdd = document.createElement("button");
        btnAdd.type = "submit";
        btnAdd.textContent = "Adicionar";
        btnAdd.style.backgroundColor = "var(--cor-principal)";
        btnAdd.style.color = "white";
        btnAdd.style.border = "none";
        btnAdd.style.borderRadius = "4px";
        btnAdd.style.padding = "4px 10px";
        btnAdd.style.cursor = "pointer";
        btnAdd.style.fontWeight = "bold";
        form.appendChild(inputNovo);
        form.appendChild(btnAdd);

        // Adiciona o formul√°rio e renderiza
        lista.parentElement.appendChild(form);
        renderizarItens();
      }

      // Fun√ß√£o para adicionar bot√µes de controle
      function adicionarBotoesControle() {
        const header = document.querySelector("header");
        const controles = document.createElement("div");
        controles.className = "controles-ficha";

        const botoes = [
          { texto: "‚è∞ Descanso Curto", funcao: descansoCurto },
          { texto: "üò¥ Descanso Longo", funcao: descansoLongo },
          { texto: "üçÄ Usar Ponto de Sorte", funcao: usarPontoSorte },
          { texto: "üíæ Salvar Ficha", funcao: salvarFicha },
          { texto: "üì• Exportar JSON", funcao: exportarFicha },
        ];

        botoes.forEach((b) => {
          const btn = document.createElement("button");
          btn.textContent = b.texto;
          btn.style.padding = "10px 15px";
          btn.style.backgroundColor = "var(--cor-principal)";
          btn.style.color = "white";
          btn.style.border = "none";
          btn.style.borderRadius = "5px";
          btn.style.cursor = "pointer";
          btn.style.fontSize = "0.85em";
          btn.style.fontWeight = "bold";
          btn.onclick = b.funcao;
          controles.appendChild(btn);
        });

        header.appendChild(controles);
      }

      // Fun√ß√£o para adicionar controle de dano
      function adicionarControleDano() {
        // Procura a se√ß√£o de Estado Atual
        const secoes = document.querySelectorAll(".secao");
        let secaoEstado = null;
        secoes.forEach((secao) => {
          if (secao.querySelector("#pv-atual-valor")) {
            secaoEstado = secao;
          }
        });
        if (!secaoEstado) return;

        // Cria o formul√°rio de dano
        const form = document.createElement("form");
        form.style.display = "flex";
        form.style.gap = "8px";
        form.style.marginTop = "10px";
        form.onsubmit = function (e) {
          e.preventDefault();
          const input = form.querySelector("input");
          let dano = parseInt(input.value);
          if (isNaN(dano) || dano <= 0) {
            alert("Informe um valor de dano v√°lido.");
            return;
          }
          estadoFicha.pvAtual = Math.max(0, estadoFicha.pvAtual - dano);
          atualizarEstadoFicha();
          alert(`Dano registrado! PV atual: ${estadoFicha.pvAtual}`);
          input.value = "";
        };

        const input = document.createElement("input");
        input.type = "number";
        input.min = "1";
        input.placeholder = "Dano";
        input.style.width = "70px";
        input.style.borderRadius = "4px";
        input.style.border = "1px solid var(--cor-borda)";
        input.style.padding = "4px";

        const btn = document.createElement("button");
        btn.type = "submit";
        btn.textContent = "Registrar Dano";
        btn.style.backgroundColor = "var(--cor-destaque)";
        btn.style.color = "white";
        btn.style.border = "none";
        btn.style.borderRadius = "4px";
        btn.style.padding = "4px 10px";
        btn.style.cursor = "pointer";
        btn.style.fontWeight = "bold";

        form.appendChild(input);
        form.appendChild(btn);
        // Bot√£o Recuperar Vida
        const btnRecuperar = document.createElement("button");
        btnRecuperar.type = "button";
        btnRecuperar.textContent = "Recuperar Vida";
        btnRecuperar.style.backgroundColor = "#4caf50";
        btnRecuperar.style.color = "white";
        btnRecuperar.style.border = "none";
        btnRecuperar.style.borderRadius = "4px";
        btnRecuperar.style.padding = "4px 10px";
        btnRecuperar.style.cursor = "pointer";
        btnRecuperar.style.fontWeight = "bold";
        btnRecuperar.onclick = function () {
          const input = form.querySelector("input");
          let cura = parseInt(input.value);
          if (isNaN(cura) || cura <= 0) {
            alert("Informe um valor de vida para recuperar.");
            return;
          }
          // Corrige para usar PV m√°ximo fixo (53)
          estadoFicha.pvAtual = Math.min(53, estadoFicha.pvAtual + cura);
          atualizarEstadoFicha();
          alert(`Vida recuperada! PV atual: ${estadoFicha.pvAtual}`);
          input.value = "";
        };
        form.appendChild(btnRecuperar);
        secaoEstado.appendChild(form);
      }
    </script>
  </body>
</html>
